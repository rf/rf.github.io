<!DOCTYPE html>  <html> <head>   <title>dpll.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               dpll.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This is an extremely simple implementation of the DPLL algorithm for
solving boolean satisfiability problems. It contains no optimizations.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The input consists of a boolean expression in Conjunctive Normal Form.
This means it looks something like this:</p>

<p><code>(A OR B) AND (B OR ~C)</code></p>

<p>We encode this as an array of arrays of integers ranging from 1 to n:</p>

<p><code>[[1, 2], [2, -3]]</code></p>

<p>A negative number implies <code>NOT</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3><code>satisfiable</code></h3>

<p>Takes a clause and a set of values and determines if the clause is
satisfiable given the values which are defined.  This will return one of
<code>true</code>, <code>false</code>, or <code>undefined</code>, if it cannot be determined whether the
clause is true or false.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">satisfiable</span> <span class="p">(</span><span class="nx">clause</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">clause</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">clause</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">item</span><span class="p">)];</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>If the value is <code>undefined</code>, it isn't useful to us.  If it is <code>false</code>,
it does not affect the value of the clause.  Continue to the next item.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">value</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>If we got here, then we have a value in the clause which is <code>true</code>;
this causes the whole clause to evaluate to <code>true</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>If we got here, we did not encounter a <code>true</code> value; so, we don't know
if the clause is <code>true</code> or <code>false</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3><code>dpll</code></h3>

<ul>
<li><code>count</code> is the total number of variables.</li>
<li><code>clauses</code> is an array of clauses.</li>
<li><code>values</code> is a set of variable assignments. </li>
<li><code>test</code> is a variable which we are attempting to set to <code>value</code>.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">dpll</span> <span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">clauses</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">test</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">values</span> <span class="o">=</span> <span class="nx">values</span><span class="o">?</span> <span class="nx">values</span><span class="p">.</span><span class="nx">slice</span><span class="p">()</span> <span class="o">:</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Filter out satisfiable clauses.  These do not need to be considered.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">clauses</span> <span class="o">=</span> <span class="nx">clauses</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">clause</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">satisfiable</span><span class="p">(</span><span class="nx">clause</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
  <span class="p">});</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Take each clause, and ...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">clauses</span> <span class="o">=</span> <span class="nx">clauses</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">clause</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>filter out literals which do not affect the value of the clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">clause</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If the variable we're considering in the clause isn't the variable
we're testing, return <code>true</code>, keeping this variable in the clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">test</span> <span class="o">!==</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Respect negation of the variable in the clause, then return the value
it is set to. If the variable is set to false, it will be removed from
the clause because it no longer affects the clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">item</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">?</span> <span class="o">!</span><span class="nx">value</span> <span class="o">:</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>If there are no clauses left after the above filtering, return the set of
values which make the expression <code>true</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">clauses</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">values</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If any of the clauses have no literals left, return <code>false</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">clauses</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Choose a new variable to try pseudorandomly.  This is a common place for
optimizations.  We can make choices based on what's worked in the past.
For simplicity, we choose randomly.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">choice</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">count</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Set the value we're going to test now.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">values</span><span class="p">[</span><span class="nx">test</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Recurse.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">dpll</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">clauses</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">||</span>
         <span class="nx">dpll</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">clauses</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">choice</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dpll</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">input</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 